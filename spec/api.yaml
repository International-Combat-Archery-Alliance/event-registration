openapi: 3.0.0
info:
  title: ICAA Event Registration
  version: 1.0.0
  description: An API for managing events and signing up for events.
servers:
  - url: https://api.icaa.world/v1
    description: Production server
  - url: http://localhost:8080/v1
    description: Local dev server
paths:
  /events:
    get:
      summary: Get all events
      description: Retrieves a list of all events
      parameters:
        - name: cursor
          in: query
          description: Cursor of where to start from
          required: false
          schema:
            type: string
        - name: limit
          in: query
          description: Max amount of events to fetch
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 50
      responses:
        '200':
          description: A list of events.
          content:
            application/json:
              schema:
                type: object
                required:
                  - data
                  - hasNextPage
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Event'
                  cursor:
                    type: string
                  hasNextPage:
                    type: boolean
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error' 
        '500':
          description: Unknown server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create a new event
      description: Admin endpoint to create a new event
      requestBody:
        description: Event to be created
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Event'
      responses:
        '200':
          description: The created event.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Unknown server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /events/{id}:
    get:
      summary: Get an event
      description: Get one event by id
      parameters:
        - name: id
          in: path
          description: ID of the event
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The event
          content:
            application/json:
              schema:
                type: object
                required:
                  - event
                properties:
                  event:
                    $ref: '#/components/schemas/Event'
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error' 
        '404':
          description: Event not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error' 
        '500':
          description: Unknown server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /events/{eventId}/register:
    post:
      summary: Sign up for an event
      description: Sign up for an event
      parameters:
        - name: eventId
          in: path
          description: ID of the event
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        description: Registration to be created
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Registration'
      responses:
        '200':
          description: The created registration.
          content:
            application/json:
              schema:
                type: object
                required:
                  - registration
                properties:
                  registration:
                    $ref: '#/components/schemas/Registration'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Not allowed to register.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Event is not found to register with
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Someone is already signed up under this email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Unknown server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /events/{eventId}/registrations:
    get:
      summary: Get all registrations for an event
      description: Get all registrations for an event
      parameters:
        - name: eventId
          in: path
          description: ID of the event
          required: true
          schema:
            type: string
            format: uuid
        - name: cursor
          in: query
          description: Cursor of where to start from
          required: false
          schema:
            type: string
        - name: limit
          in: query
          description: Max amount of registrations to fetch
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 50
      responses:
        '200':
          description: A list of registrations.
          content:
            application/json:
              schema:
                type: object
                required:
                  - data
                  - hasNextPage
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Registration'
                  cursor:
                    type: string
                  hasNextPage:
                    type: boolean
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error' 
        '500':
          description: Unknown server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          

components:
  schemas:
    Event:
      type: object
      required:
        - id
        - version
        - name
        - location
        - startTime
        - endTime
        - registrationCloseTime
        - registrationTypes
        - allowedTeamSizeRange
        - signUpStats
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
        version:
          type: integer
          readOnly: true
        name:
          type: string
          minLength: 3
          maxLength: 255
        location:
          $ref: '#/components/schemas/Location'
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
        registrationCloseTime:
          type: string
          format: date-time
        registrationTypes:
          type: array
          items:
            $ref: '#/components/schemas/RegistrationType'
        allowedTeamSizeRange:
          $ref: '#/components/schemas/Range'
        signUpStats:
          $ref: '#/components/schemas/SignUpStats'
    SignUpStats:
      type: object
      readOnly: true
      required:
        - numTeams
        - numRosteredPlayers
        - numTotalPlayers
      properties:
        numTeams:
          type: integer
        numRosteredPlayers:
          type: integer
        numTotalPlayers:
          type: integer
    Registration:
      oneOf:
        - $ref: '#/components/schemas/IndividualRegistration'
        - $ref: '#/components/schemas/TeamRegistration'
      discriminator:
        propertyName: registrationType
        mapping:
          ByIndividual: '#/components/schemas/IndividualRegistration'
          ByTeam: '#/components/schemas/TeamRegistration'
    IndividualRegistration:
      type: object
      required:
        - registrationType
        - id
        - version
        - eventId
        - registeredAt
        - email
        - homeCity
        - playerInfo
        - experience
        - paid
      properties:
        registrationType:
          $ref: '#/components/schemas/RegistrationType'
        id:
          type: string
          format: uuid
          readOnly: true
        version:
          type: integer
          readOnly: true
        eventId:
          type: string
          format: uuid
          readOnly: true
        registeredAt:
          type: string
          format: date-time
          readOnly: true
        email:
          type: string
          format: email
          minLength: 3
          maxLength: 100
        homeCity:
          type: string
          minLength: 3
          maxLength: 100
        playerInfo:
          $ref: '#/components/schemas/PlayerInfo'
        experience:
          $ref: '#/components/schemas/ExperienceLevel'
        paid:
          type: boolean
          readOnly: true
    TeamRegistration:
      type: object
      required:
        - registrationType
        - id
        - version
        - eventId
        - registeredAt
        - teamName
        - homeCity
        - captainEmail
        - players
        - paid
      properties:
        registrationType:
          $ref: '#/components/schemas/RegistrationType'
        id:
          type: string
          format: uuid
          readOnly: true
        version:
          type: integer
          readOnly: true
        eventId:
          type: string
          format: uuid
          readOnly: true
        registeredAt:
          type: string
          format: date-time
          readOnly: true
        teamName:
          type: string
          minLength: 3
          maxLength: 100
        homeCity:
          type: string
          minLength: 3
          maxLength: 100
        captainEmail:
          type: string
          format: email
          maxLength: 100
        players:
          type: array
          items:
            $ref: '#/components/schemas/PlayerInfo'
        paid:
          type: boolean
          readOnly: true
    PlayerInfo:
      type: object
      required:
        - firstName
        - lastName
      properties:
        firstName:
          type: string
          minLength: 1
          maxLength: 50
        lastName:
          type: string
          minLength: 1
          maxLength: 50
    Location:
      type: object
      required:
        - name
        - address
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
        address:
          $ref: '#/components/schemas/Address'
    Address:
      type: object
      properties:
        street:
          type: string
          description: Street address
          minLength: 3
          maxLength: 255
        city:
          type: string
          description: City or town
          minLength: 3
          maxLength: 50
        state:
          type: string
          description: State or province
          minLength: 2
          maxLength: 50
        postalCode:
          type: string
          description: Postal code
          minLength: 3
          maxLength: 20
        country:
          type: string
          description: Country
          minLength: 2
          maxLength: 50
      required:
        - street
        - city
        - state
        - postalCode
        - country
    Range:
      type: object
      required:
        - min
        - max
      properties:
        min:
          type: integer
        max:
          type: integer
    RegistrationType:
      type: string
      enum:
        - ByIndividual
        - ByTeam
    ExperienceLevel:
      type: string
      enum:
        - Novice
        - Intermediate
        - Advanced
    ErrorCode:
      type: string
      enum:
        - InternalError
        - LimitOutOfBounds
        - InvalidCursor
        - NotFound
        - EmptyBody
        - InvalidBody
        - AlreadyExists
        - RegistrationClosed
        - InputValidationError
        - AuthError
    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          $ref: '#/components/schemas/ErrorCode'
        message:
          type: string
